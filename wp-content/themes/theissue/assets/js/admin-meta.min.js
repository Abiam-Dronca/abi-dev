jQuery(function(r){r(".thb-register:not(.disabled)").on("click",function(e){var t=r(this),a=r("#thb_product_key").val(),s=r("#thb_purchase_code").val(),n=t.hasClass("thb_purchase_code"),i=n?t.data("verify-by-purchase"):t.data("verify"),o={domain:t.data("domain")};return n?o.purchase_code=s:o.product_key=a,r.ajax({method:"GET",url:i,data:o,beforeSend:function(){t.addClass("disabled")},error:function(e){t.removeClass("disabled"),!e.responseText||(e=r.parseJSON(e.responseText)).error_message&&("Invalid product_key"===e.error_message?t.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> Invalid Product Key</p><p><small>Please make sure that you are using the exactly the same​ WordPress URL inside Settings > General.</small></p></div>'):"Invalid purchase_code"===e.error_message?t.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> Invalid Envato Purchase Code</p><p><small>Please make sure that you are using the correct Envato Purchase Code for this theme.</small></p></div>'):"Invalid domain"===e.error_message?t.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> Invalid Domain</p><p><small>Please make sure that you are using the exactly the same​ WordPress URL inside Settings > General.</small></p></div>'):t.parents(".step").find(".thb_error_messages").html('<div class="thb-error"><p><span class="dashicons dashicons-warning"></span> '+e.error_message+"</p></div>"))},success:function(e){e.product_key&&(a=e.product_key),r.ajax(ajaxurl,{method:"POST",data:{action:"thb_update_options",key:a,expired:0,security:t.data("security")},success:function(){location.reload()}})}}),!1}),r(".thb-delete-key").on("click",function(e){var t=r(this);return r.ajax(ajaxurl,{method:"POST",data:{action:"thb_update_options",key:"",expired:0,security:t.data("security")},success:function(){location.reload()}}),!1});var a={popup:r("#thb-adm-popup"),close:r(".thb-popup-close"),btn:r(".import-opts-btn")};a.close.on("click",function(){r(this).closest(a.popup).removeClass("opvis")}),r(document).on("keyup",function(e){27===e.keyCode&&a.popup.hasClass("opvis")&&a.close.trigger("click")}),r(".thb-check-line [type=checkbox]").on("change",function(){var e=r(this);e.toggleClass("thb-checked"),"ty-contents"===e.attr("id")&&(e.hasClass("child-opened")?e.removeClass("child-opened").parent().next().removeClass("done"):e.addClass("child-opened").parent().next().addClass("done"))}),a.btn.on("click",function(){var e=r(this),t=e.data("demo");a.popup.find(".button").data("selected",t),a.popup.find("figure img").attr("src",e.closest(".theme").find("img").attr("src")),a.popup.find("[type=checkbox]"),a.popup.addClass("opvis")});var s=new FormData;"undefined"!=typeof ocdi&&(s.append("action","ocdi_import_demo_data"),s.append("security",ocdi.ajax_nonce)),a.popup.find("form").on("submit",function(e){e.preventDefault();var t=r(this),e=t.find(".button").data("selected");a.popup.find("form").addClass("thb-loading"),t.closest(".thb-popup-box").find(".thb-import-loading").addClass("opvis"),t.children("[type=submit]").addClass("disabled").attr("disabled","disabled").unbind("click"),s.append("selected",e),s.append("thb_import_options",t.serialize()),function t(a){r.ajax({method:"POST",url:ocdi.ajax_url,data:a,contentType:!1,processData:!1}).done(function(e){void 0!==e.status&&"newAJAX"===e.status?t(a):void 0!==e.status&&"afterAllImportAJAX"===e.status?((e=new FormData).append("action","ocdi_after_import_data"),e.append("security",ocdi.ajax_nonce),t(e)):location.reload()})}(s)}),ThbImage={uploader:function(e,t,a){var s=wp.media({title:ThbImageWidget.frame_title,multiple:!1,library:{type:"image"},button:{text:ThbImageWidget.button_title}});return s.on("close",function(){var e=s.state().get("selection").toJSON();r("#"+t).val(e[0].id),r("#"+t).parents(".widget-content").find(".thb-widget-image-holder").html("<img src="+e[0].sizes.thumbnail.url+" />")}),s.open(),!1}};function e(e){var s=e.find(".thb-image-holder"),n=e.find(".thb-upload-image"),i=e.find(".thb-remove-image"),o=e.find(".thb-image-id");0<parseInt(o.val(),10)?(n.hide(),i.show()):(n.show(),i.hide()),n.on("click",function(e){var t,a;e.preventDefault(),t=function(e){var t="",t=void 0!==e.sizes.thumbnail?e.sizes.thumbnail:e.sizes.full;s.html('<img src="'+t.url+'" width="'+t.width+'" height="'+t.height+'" />'),o.val(e.id),n.hide(),i.show()},(a=wp.media({title:"Select an image",multiple:!1,library:{type:"image"},button:{text:"Add Image"}})).on("select",function(){var e=a.state().get("selection").first().toJSON();t(e)}),a.open()}),i.on("click",function(e){e.preventDefault(),confirm("Are you sure?")&&(s.empty(),o.val(""),n.show(),i.hide())})}function t(){r(".thb_widget_layout_row").each(function(){var e=r(this),t=e.find("select"),a=e.parents(".widget-content");t.on("change",function(){"thumbnail"===this.value?a.find(".thb_thumbnail_style_row, .thb_thumbnail_counter_row").show():a.find(".thb_thumbnail_style_row, .thb_thumbnail_counter_row").hide()}).trigger("change")}),r(".thb_orderby_row").each(function(){var e=r(this),t=e.find("select"),a=e.parents(".widget-content");t.on("change",function(){"views"===this.value?(a.find(".thb_trending_row").show(),a.find(".thb_timeframe_row").hide()):(a.find(".thb_timeframe_row").show(),a.find(".thb_trending_row").hide())}).trigger("change")})}r(".thb-upload-image-field").each(function(){e(r(this))}),r(".thb-author-search").each(function(){var t=r(this).data("security"),e={allowClear:!1,placeholder:r(this).data("placeholder"),minimumInputLength:"3",escapeMarkup:function(e){return e},ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{term:e.term,action:"thb_json_search_authors",security:t}},processResults:function(e){var a=[];return e&&(console.log(e),r.each(e,function(e,t){a.push({id:e,text:t})})),{results:a}},cache:!0}};r(this).select2(e)}),r(".thb-post-search").each(function(){var t=r(this).data("security"),e={allowClear:!1,placeholder:r(this).data("placeholder"),minimumInputLength:"3",escapeMarkup:function(e){return e},ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{term:e.term,action:"thb_json_search_posts",security:t}},processResults:function(e){var a=[];return e&&r.each(e,function(e,t){a.push({id:e,text:t})}),{results:a}},cache:!0}};r(this).select2(e)}),t(),r(document).on("widget-updated widget-added",t)});